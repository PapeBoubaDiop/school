<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ENSAE - Gestion des Absences</title>
  <link rel="shortcut icon" href="assets/img/favicon.png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap">
  <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
  <link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    .absence-card { 
      border-left: 4px solid #dc3545; 
      transition: all 0.3s ease;
    }
    .absence-card.justified { 
      border-left-color: #28a745; 
    }
    .absence-card.pending { 
      border-left-color: #ffc107; 
    }
    .absence-card:hover { 
      box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
      transform: translateY(-2px);
    }
    .student-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
    }
    .status-badge {
      font-size: 0.85em;
      padding: 6px 12px;
    }
    .date-badge { 
      position: absolute; 
      top: 15px; 
      right: 15px; 
      font-size: 0.8em;
    }
    .add-absence-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
    }
    .filter-section {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 25px;
    }
    .stats-card {
      text-align: center;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .stats-number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .action-buttons {
      margin-top: 12px;
    }
    .absence-details {
      margin-top: 15px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }
    .modal-backdrop.show {
      opacity: 0.8;
    }
    .form-floating > label {
      color: #6c757d;
    }
  </style>
</head>
<body>
  <div class="main-wrapper">
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <a href="02_index.html" class="logo">
          <img src="assets/img/logo.png" alt="Logo">
        </a>
        <a href="02_index.html" class="logo logo-small">
          <img src="assets/img/logo-small.png" alt="Logo" width="30" height="30">
        </a>
      </div>
      <a href="#" id="toggle_btn"><i class="fas fa-align-left"></i></a>
      <div class="top-nav-search">
        <form>
          <input type="text" class="form-control" placeholder="Rechercher un étudiant...">
          <button class="btn" type="submit"><i class="fas fa-search"></i></button>
        </form>
      </div>
      <a class="mobile_btn" id="mobile_btn"><i class="fas fa-bars"></i></a>
      <ul class="nav user-menu">
        <li class="nav-item dropdown has-arrow">
          <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
            <img class="rounded-circle" src="assets/img/profiles/avatar-01.jpg" width="31" alt="Admin">
          </a>
          <div class="dropdown-menu">
            <div class="user-header">
              <div class="avatar avatar-sm">
                <img src="assets/img/profiles/avatar-01.jpg" alt="User Image" class="avatar-img rounded-circle">
              </div>
              <div class="user-text">
                <h6>Responsable AS1</h6>
                <p class="text-muted mb-0">Responsable de classe</p>
              </div>
            </div>
            <a class="dropdown-item" href="profile.html">Mon profil</a>
            <a class="dropdown-item" href="login.html">Déconnexion</a>
          </div>
        </li>
      </ul>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-inner slimscroll">
        <div id="sidebar-menu" class="sidebar-menu">
          <ul>
            <li class="menu-title"><span>Menu</span></li>
            <li><a href="02_index.html"><i class="fas fa-chart-line"></i> <span>Dashboard</span></a></li>
            <li><a href="02_matieres.html"><i class="fas fa-book-open"></i> <span>Matières</span></a></li>
            <li><a href="02_professeurs.html"><i class="fas fa-chalkboard-teacher"></i> <span>Professeurs</span></a></li>
            <li><a href="02_etudiants.html"><i class="fas fa-user-graduate"></i> <span>Étudiants</span></a></li>
            <li class="active"><a href="02_absences.html"><i class="fas fa-user-times"></i> <span>Absences</span></a></li>
            <li><a href="02_cahier_texte.html"><i class="fas fa-book"></i> <span>Cahier de texte</span></a></li>
            <li><a href="02_devoir_projet.html"><i class="fas fa-clipboard-list"></i> <span>Devoirs & Projets</span></a></li>
            <li><a href="02_emploi_temps.html"><i class="fas fa-calendar-alt"></i> <span>Emploi du temps</span></a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="page-wrapper">
      <div class="content container-fluid">
        <div class="page-header">
          <div class="row">
            <div class="col-sm-8">
              <h3 class="page-title">Gestion des Absences - Classe AS1</h3>
              <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="02_index.html">Dashboard</a></li>
                <li class="breadcrumb-item active">Absences</li>
              </ul>
            </div>
            <div class="col-sm-4 text-right">
              <div class="btn-group">
                <button class="btn btn-outline-primary btn-sm" onclick="exportAbsences()">
                  <i class="fas fa-download"></i> Exporter
                </button>
                <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#addAbsenceModal">
                  <i class="fas fa-plus"></i> Nouvelle absence
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Statistiques -->
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card stats-card bg-danger text-white">
              <div class="stats-number">8</div>
              <div>Absences injustifiées</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stats-card bg-success text-white">
              <div class="stats-number">12</div>
              <div>Absences justifiées</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stats-card bg-warning text-white">
              <div class="stats-number">3</div>
              <div>En attente</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stats-card bg-info text-white">
              <div class="stats-number">23</div>
              <div>Total absences</div>
            </div>
          </div>
        </div>

        <!-- Filtres -->
        <div class="filter-section">
          <div class="row">
            <div class="col-md-3">
              <div class="form-group">
                <label>Étudiant</label>
                <select class="form-control" id="filterStudent">
                  <option value="">Tous les étudiants</option>
                  <option value="martin-sophie">Martin Sophie</option>
                  <option value="dubois-pierre">Dubois Pierre</option>
                  <option value="bernard-marie">Bernard Marie</option>
                  <option value="petit-jean">Petit Jean</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label>Statut</label>
                <select class="form-control" id="filterStatus">
                  <option value="">Tous les statuts</option>
                  <option value="unjustified">Injustifiée</option>
                  <option value="justified">Justifiée</option>
                  <option value="pending">En attente</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label>Matière</label>
                <select class="form-control" id="filterSubject">
                  <option value="">Toutes les matières</option>
                  <option value="maths">Mathématiques</option>
                  <option value="stats">Statistiques</option>
                  <option value="anglais">Anglais</option>
                  <option value="info">Informatique</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label>Période</label>
                <select class="form-control" id="filterPeriod">
                  <option value="">Toute la période</option>
                  <option value="today">Aujourd'hui</option>
                  <option value="week">Cette semaine</option>
                  <option value="month">Ce mois</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <button class="btn btn-primary" onclick="applyFilters()">
                <i class="fas fa-filter"></i> Appliquer les filtres
              </button>
              <button class="btn btn-outline-secondary ml-2" onclick="resetFilters()">
                <i class="fas fa-undo"></i> Réinitialiser
              </button>
            </div>
          </div>
        </div>

        <!-- Liste des absences -->
        <div class="row" id="absencesList">
          <!-- Absence 1 -->
          <div class="col-12">
            <div class="card absence-card mb-3">
              <div class="card-body position-relative">
                <span class="badge badge-danger date-badge">22 Mai 2025</span>
                <div class="d-flex align-items-start mb-3">
                  <img src="assets/img/profiles/student-01.jpg" alt="Sophie Martin" class="student-avatar mr-3">
                  <div class="flex-grow-1">
                    <h5 class="mb-1">Martin Sophie</h5>
                    <small class="text-muted">
                      <i class="fas fa-id-card"></i> ID: AS1-2025-001  | 
                      <i class="fas fa-envelope"></i> sophie.martin@ensae.fr
                    </small>
                  </div>
                  <span class="badge badge-danger status-badge mr-3">Injustifiée</span>
                  <div class="action-buttons">
                    <button class="btn btn-sm btn-outline-primary mr-2" onclick="editAbsence(1)">
                      <i class="fas fa-edit"></i> Modifier
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteAbsence(1)">
                      <i class="fas fa-trash"></i> Supprimer
                    </button>
                  </div>
                </div>
                
                <div class="absence-details">
                  <div class="row">
                    <div class="col-md-4">
                      <strong><i class="fas fa-book text-primary"></i> Matière :</strong><br>
                      Mathématiques
                    </div>
                    <div class="col-md-4">
                      <strong><i class="fas fa-clock text-primary"></i> Horaire :</strong><br>
                      08:00 - 10:00
                    </div>
                    <div class="col-md-4">
                      <strong><i class="fas fa-user text-primary"></i> Professeur :</strong><br>
                      M. Dupont
                    </div>
                  </div>
                  <div class="row mt-2">
                    <div class="col-md-6">
                      <strong><i class="fas fa-map-marker-alt text-primary"></i> Salle :</strong>
                      Salle 204
                    </div>
                    <div class="col-md-6">
                      <strong><i class="fas fa-calendar text-primary"></i> Signalée le :</strong>
                      22 Mai 2025 à 08:15
                    </div>
                  </div>
                  <div class="mt-2">
                    <strong><i class="fas fa-comment text-warning"></i> Remarques :</strong>
                    <p class="mb-0 mt-1">Absence non signalée à l'avance. Aucune justification fournie.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Absence 2 -->
          <div class="col-12">
            <div class="card absence-card justified mb-3">
              <div class="card-body position-relative">
                <span class="badge badge-secondary date-badge">21 Mai 2025</span>
                <div class="d-flex align-items-start mb-3">
                  <img src="assets/img/profiles/student-02.jpg" alt="Pierre Dubois" class="student-avatar mr-3">
                  <div class="flex-grow-1">
                    <h5 class="mb-1">Dubois Pierre</h5>
                    <small class="text-muted">
                      <i class="fas fa-id-card"></i> ID: AS1-2025-002  | 
                      <i class="fas fa-envelope"></i> pierre.dubois@ensae.fr
                    </small>
                  </div>
                  <span class="badge badge-success status-badge mr-3">Justifiée</span>
                  <div class="action-buttons">
                    <button class="btn btn-sm btn-outline-primary mr-2" onclick="editAbsence(2)">
                      <i class="fas fa-edit"></i> Modifier
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteAbsence(2)">
                      <i class="fas fa-trash"></i> Supprimer
                    </button>
                  </div>
                </div>
                
                <div class="absence-details">
                  <div class="row">
                    <div class="col-md-4">
                      <strong><i class="fas fa-book text-primary"></i> Matière :</strong><br>
                      Statistiques
                    </div>
                    <div class="col-md-4">
                      <strong><i class="fas fa-clock text-primary"></i> Horaire :</strong><br>
                      14:00 - 16:00
                    </div>
                    <div class="col-md-4">
                      <strong><i class="fas fa-user text-primary"></i> Professeur :</strong><br>
                      Mme Martin
                    </div>
                  </div>
                  <div class="row mt-2">
                    <div class="col-md-6">
                      <strong><i class="fas fa-map-marker-alt text-primary"></i> Salle :</strong>
                      Salle 105
                    </div>
                    <div class="col-md-6">
                      <strong><i class="fas fa-calendar text-primary"></i> Signalée le :</strong>
                      20 Mai 2025 à 16:30
                    </div>
                  </div>
                  <div class="mt-2">
                    <strong><i class="fas fa-file-medical text-success"></i> Justification :</strong>
                    <p class="mb-0 mt-1"><span class="badge badge-light">Certificat médical</span> - Rendez-vous médical. Document fourni par mail le 20/05.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Absence 3 -->
          <div class="col-12">
            <div class="card absence-card pending mb-3">
              <div class="card-body position-relative">
                <span class="badge badge-secondary date-badge">20 Mai 2025</span>
                <div class="d-flex align-items-start mb-3">
                  <img src="assets/img/profiles/student-03.jpg" alt="Marie Bernard" class="student-avatar mr-3">
                  <div class="flex-grow-1">
                    <h5 class="mb-1">Bernard Marie</h5>
                    <small class="text-muted">
                      <i class="fas fa-id-card"></i> ID: AS1-2025-003  | 
                      <i class="fas fa-envelope"></i> marie.bernard@ensae.fr
                    </small>
                  </div>
                  <span class="badge badge-warning status-badge mr-3">En attente</span>
                  <div class="action-buttons">
                    <button class="btn btn-sm btn-outline-primary mr-2" onclick="editAbsence(3)">
                      <i class="fas fa-edit"></i> Modifier
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteAbsence(3)">
                      <i class="fas fa-trash"></i> Supprimer
                    </button>
                  </div>
                </div>
                
                <div class="absence-details">
                  <div class="row">
                    <div class="col-md-4">
                      <strong><i class="fas fa-book text-primary"></i> Matière :</strong><br>
                      Anglais
                    </div>
                    <div class="col-md-4">
                      <strong><i class="fas fa-clock text-primary"></i> Horaire :</strong><br>
                      10:15 - 12:15
                    </div>
                    <div class="col-md-4">
                      <strong><i class="fas fa-user text-primary"></i> Professeur :</strong><br>
                      Mme Johnson
                    </div>
                  </div>
                  <div class="row mt-2">
                    <div class="col-md-6">
                      <strong><i class="fas fa-map-marker-alt text-primary"></i> Salle :</strong>
                      Salle 301
                    </div>
                    <div class="col-md-6">
                      <strong><i class="fas fa-calendar text-primary"></i> Signalée le :</strong>
                      20 Mai 2025 à 09:45
                    </div>
                  </div>
                  <div class="mt-2">
                    <strong><i class="fas fa-hourglass-half text-warning"></i> En cours de validation :</strong>
                    <p class="mb-0 mt-1">Justification fournie par l'étudiant. En attente de validation du certificat médical.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="row mt-4">
          <div class="col-12 d-flex justify-content-center">
            <nav>
              <ul class="pagination">
                <li class="page-item disabled">
                  <a class="page-link" href="#" tabindex="-1">Précédent</a>
                </li>
                <li class="page-item active">
                  <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">2</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">3</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">Suivant</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="text-center mt-4 mb-3">
        <p>© 2025 ENSAE - Gestion classe Analyse Statistique</p>
      </footer>
    </div>
  </div>

  <!-- Bouton flottant d'ajout -->
  <button class="btn btn-primary add-absence-btn d-md-none" data-toggle="modal" data-target="#addAbsenceModal">
    <i class="fas fa-plus fa-lg"></i>
  </button>

  <!-- Modal d'ajout/modification d'absence -->
  <div class="modal fade" id="addAbsenceModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-user-times text-warning"></i> <span id="modalTitle">Nouvelle absence</span>
          </h5>
          <button type="button" class="close" data-dismiss="modal">
            <span>×</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="absenceForm">
            <input type="hidden" id="absenceId">
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <select class="form-control" id="studentSelect" required>
                    <option value="">Sélectionner un étudiant</option>
                    <option value="martin-sophie">Martin Sophie</option>
                    <option value="dubois-pierre">Dubois Pierre</option>
                    <option value="bernard-marie">Bernard Marie</option>
                    <option value="petit-jean">Petit Jean</option>
                  </select>
                  <label for="studentSelect">Étudiant</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <input type="date" class="form-control" id="absenceDate" required>
                  <label for="absenceDate">Date d'absence</label>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-4">
                <div class="form-floating mb-3">
                  <select class="form-control" id="subjectSelect" required>
                    <option value="">Sélectionner une matière</option>
                    <option value="maths">Mathématiques</option>
                    <option value="stats">Statistiques</option>
                    <option value="eco">Économie</option>
                    <option value="anglais">Anglais</option>
                    <option value="info">Informatique</option>
                  </select>
                  <label for="subjectSelect">Matière</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-floating mb-3">
                  <input type="time" class="form-control" id="startTime" required>
                  <label for="startTime">Heure de début</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-floating mb-3">
                  <input type="time" class="form-control" id="endTime" required>
                  <label for="endTime">Heure de fin</label>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control" id="teacherName" placeholder="Ex: M. Dupont">
                  <label for="teacherName">Professeur</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <input type="text" class="form-control" id="roomNumber" placeholder="Ex: Salle 204">
                  <label for="roomNumber">Salle</label>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <select class="form-control" id="absenceStatus" required>
                    <option value="unjustified">Injustifiée</option>
                    <option value="justified">Justifiée</option>
                    <option value="pending">En attente de justification</option>
                  </select>
                  <label for="absenceStatus">Statut</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating mb-3">
                  <select class="form-control" id="justificationType">
                    <option value="">Aucune justification</option>
                    <option value="medical">Certificat médical</option>
                    <option value="family">Motif familial</option>
                    <option value="transport">Problème de transport</option>
                    <option value="other">Autre</option>
                  </select>
                  <label for="justificationType">Type de justification</label>
                </div>
              </div>
            </div>

            <div class="form-floating mb-3">
              <textarea class="form-control" id="absenceRemarks" style="height: 100px" placeholder="Remarques sur l'absence..."></textarea>
              <label for="absenceRemarks">Remarques (optionnel)</label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" onclick="saveAbsence()">
            <i class="fas fa-save"></i> <span id="saveButtonText">Enregistrer</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js"></script>

  <script>
    // Variables pour stocker les absences
    let absences = [];
    let editingAbsenceId = null;

    // Initialisation
    $(document).ready(function() {
      // Définir la date du jour par défaut
      document.getElementById('absenceDate').valueAsDate = new Date();
      
      // Réinitialiser le modal à la fermeture
      $('#addAbsenceModal').on('hidden.bs.modal', function() {
        resetModal();
      });
    });

    function saveAbsence() {
      const form = document.getElementById('absenceForm');
      
      // Validation basique
      const requiredFields = ['studentSelect', 'absenceDate', 'subjectSelect', 'startTime', 'endTime', 'absenceStatus'];
      let isValid = true;
      
      requiredFields.forEach(field => {
        const input = document.getElementById(field);
        if (!input.value.trim()) {
          input.classList.add('is-invalid');
          isValid = false;
        } else {
          input.classList.remove('is-invalid');
        }
      });

      if (!isValid) {
        showToast('Veuillez remplir tous les champs obligatoires.', 'error');
        return;
      }

      // Créer l'objet absence
      const absenceData = {
        id: editingAbsenceId || Date.now(),
        student: document.getElementById('studentSelect').options[document.getElementById('studentSelect').selectedIndex].text,
        date: document.getElementById('absenceDate').value,
        subject: document.getElementById('subjectSelect').options[document.getElementById('subjectSelect').selectedIndex].text,
        startTime: document.getElementById('startTime').value,
        endTime: document.getElementById('endTime').value,
        teacher: document.getElementById('teacherName').value,